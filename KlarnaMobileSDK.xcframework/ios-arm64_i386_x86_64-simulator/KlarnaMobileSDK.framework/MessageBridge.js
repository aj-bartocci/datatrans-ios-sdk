(()=>{"use strict";var e={935:(e,s,r)=>{s.__esModule=!0;var o=r(442),t=r(26),a=r(857),n=r(74),i=r(356),d=r(933),l=r(995),g=r(887),u=r(179),c=r(532),p=r(95),v=r(321),f=r(140),w=r(938),M=r(571),m=r(79),h=function(){function e(){this.nativeReady=!1,this.receivers=[],this.queuedMessages=[],this.queuedKlarnaPaymentsMessages=[],this.version=m.MessageBridgeVersion,this.eventListeners=[],this.handshakeResponseParamsMap={},this.base64Controller=new g.Base64ControllerImpl,this.messageController=new u.MessageControllerImpl,this.crossWindowController=new c.CrossWindowControllerImpl(this),this.nativeController=new f.NativeControllerImpl,this.receiverController=new M.ReceiverControllerImpl,this.base64Controller.overrideDefaults(),this.setupCrossWindowController()}return e.prototype.addReceiver=function(e,s){try{this.receiverController.addReceiver(this,e,s),this.notifyEvent({name:"AddedReceiver",payload:{name:e}})}catch(s){l.Logger.default.error("MessageBridge.addReceiver failed.",s),this.notifyEvent({name:"AddReceiverFailed",payload:{name:e,error:s.toString()}})}},e.prototype.removeReceiver=function(e,s){try{this.receiverController.removeReceiver(this,e,s),this.notifyEvent({name:"RemovedReceiver",payload:{name:e}})}catch(s){l.Logger.default.error("MessageBridge.removeReceiver failed.",s),this.notifyEvent({name:"RemoveReceiverFailed",payload:{name:e,error:s.toString()}})}},e.prototype.postMessage=function(e,s){void 0===s&&(s=!1);try{this.messageController.postMessage(this,e,s)}catch(s){l.Logger.default.error("MessageBridge.postMessage failed.",s),this.notifyEvent({name:"PostMessageFailed",payload:{action:e.action,sender:e.sender,receiver:e.receiver,error:s.toString()}})}},e.prototype.isNativeReady=function(){return this.nativeController.isNativeReady(this)},e.prototype.isNativeReadyAsync=function(){return this.nativeController.isNativeReadyAsync(this)},e.prototype.setNativeReady=function(){try{this.nativeController.setNativeReady(this),this.reportEndpoints()}catch(e){l.Logger.default.error("MessageBridge.setNativeReady failed.",e),this.notifyEvent({name:"NativeHookSetNativeReadyFailed",payload:{receivers:this.receivers.toString(),queuedMessages:this.queuedMessages.toString(),error:e.toString()}})}},e.prototype.inSdkWebView=function(){try{return this.nativeController.isSdkWebView(this)}catch(e){return l.Logger.default.error("MessageBridge.inSdkWebView failed.",e),!1}},e.prototype.inSdkWebViewAsync=function(){return this.nativeController.isSdkWebViewAsync(this)},e.prototype.addEventListener=function(e){this.eventListeners.indexOf(e)<=-1&&this.eventListeners.push(e)},e.prototype.removeEventListener=function(e){this.eventListeners=this.eventListeners.filter((function(s){return s!=e}))},e.prototype.notifyEvent=function(e){this.eventListeners.forEach((function(s){return s(e)}))},e.prototype.compareVersion=function(e,s){try{return d.Utils.compareVersion(e,s)}catch(e){return l.Logger.default.error("MessageBridge.compareVersion failed.",e),0}},e.prototype.destroy=function(){this.teardownCrossWindowController()},e.prototype.setupCrossWindowController=function(){if(this.crossWindowController.register(this),this.crossWindowController.mode===p.CrossWindowMode.Frame){var e=new w.CrossWindowMessageImpl(v.CrossWindowMessageAction.IsNativeReadyRequest,null);this.crossWindowController.postMessage(e);var s=new w.CrossWindowMessageImpl(v.CrossWindowMessageAction.IsSdkWebViewRequest,null);this.crossWindowController.postMessage(s)}else this.nativeController.isSdkWebView(this);l.Logger.default.debug("CrossWindowController Setup")},e.prototype.teardownCrossWindowController=function(){this.crossWindowController.unregister(this),l.Logger.default.debug("CrossWindowController Teardown")},e.prototype.reportEndpoints=function(){var e=new t.BridgeDataImpl(this.version,new a.EndpointDataImpl(n.Endpoints.Analytics.Staging,n.Endpoints.Analytics.Production),new a.EndpointDataImpl(n.Endpoints.DeviceData.Staging,n.Endpoints.DeviceData.Production));this.messageController.postEventMessageToNative(this,new o.BridgeMessageImpl(i.BridgeMessageAction.EndpointsReported,null,null,e))},e}();s.MessageBridgeImpl=h},887:(e,s,r)=>{s.__esModule=!0;var o=r(995),t=r(79),a=function(){function e(){}return e.prototype.overrideDefaults=function(){if(null==window.defaultAtob||null==window.sdkAtob){var e=window.atob,s=function(s){return 0===s.indexOf(t.KlarnaUtf8Base64Prefix)?function(s){try{return decodeURIComponent(atob(s).split("").map((function(e){var s;return null===(s=e.charCodeAt(0).toString(16).match(/.{1,2}/g))||void 0===s?void 0:s.map((function(e){return"%"+("00"+e).slice(-2)})).join("")})).join(""))}catch(r){o.Logger.default.error("atob-custom",{"src-string":s,msg:r.toString()});try{return e(s)}catch(e){throw o.Logger.default.error("atob-default",{"src-string":s,msg:e.toString()}),e}}}(s.substr(t.KlarnaUtf8Base64Prefix.length)):e(s)};window.atob=s,window.defaultAtob=e,window.sdkAtob=s}else o.Logger.default.debug("Already installed custom atob(). Skipping.")},e}();s.Base64ControllerImpl=a},532:(e,s,r)=>{s.__esModule=!0;var o=r(321),t=r(95),a=r(995),n=r(448),i=r(870),d=r(820),l=r(938),g=r(933),u=r(207),c=r(24),p=r(539),v=function(){function e(s){var r=this;this.windows=[],this.delegates=[new c.RegisterWindowMessageDelegate,new u.IsSdkWebViewMessageDelegate,new d.NativeReadyMessageDelegate,new n.NativeMessageDelegate,new i.ReceiverMessageDelegate],this.responseCallbacks={},this.listener=function(e){try{r.receivedMessage(e)}catch(e){a.Logger.default.error("CrossWindowMessage listener caught exception",e)}},this.windowId=e.getWindowId(),this.messageBridge=s,window.self!==window.top?this.mode=t.CrossWindowMode.Frame:this.mode=t.CrossWindowMode.Root}return e.getWindowId=function(){var e=window.__KlarnaNativeHookWindowId;if(e)return e;var s=g.Utils.createUUIDv4();return window.__KlarnaNativeHookWindowId=s,s},e.prototype.postMessage=function(e,s){void 0===s&&(s=null);try{a.Logger.default.debug("CrossWindowMessage Will Send",e,window.__KlarnaNativeHook),s&&(this.responseCallbacks[e.messageId]=s);var r=e.encode();switch(this.mode){case t.CrossWindowMode.Root:p.CrossWindowUtils.postMessageToNestedWindows(r,window.self);break;case t.CrossWindowMode.Frame:p.CrossWindowUtils.postMessageToWindow(r,window.top)}}catch(r){a.Logger.default.error("CrossWindowMessage post has failed",e,s,window.__KlarnaNativeHook,r)}},e.prototype.register=function(e){if(this.messageBridge!=e){var s=this.messageBridge;this.messageBridge=e,a.Logger.default.debug("CrossWindowController message bridge replaced",e,s)}window.addEventListener("message",this.listener,{once:!1,capture:!1,passive:!1}),this.mode===t.CrossWindowMode.Frame&&this.postMessage(new l.CrossWindowMessageImpl(o.CrossWindowMessageAction.RegisterWindow,null)),a.Logger.default.debug("CrossWindowController Registered")},e.prototype.unregister=function(e){this.messageBridge=null,window.removeEventListener("message",this.listener,{capture:!1}),a.Logger.default.debug("CrossWindowController Un-Registered")},e.prototype.receivedMessage=function(e){if(a.Logger.default.debug("MessageEvent Received",e),e.source!==window.self){var s=e.data,r=l.CrossWindowMessageImpl.decode(s);a.Logger.default.debug("CrossWindowMessage Received",r,window.__KlarnaNativeHook),this.receivedCrossWindowMessage(r),a.Logger.default.debug("CrossWindowMessage Processed",r,window.__KlarnaNativeHook)}else a.Logger.default.debug("MessageEvent received from self")},e.prototype.receivedCrossWindowMessage=function(e){if(this.validateCrossWindowMessage(e)){var s=this.messageBridge;if(null!=s){if(!this.callResponseCallback(e)){for(var r=0,o=this.delegates;r<o.length;r++){if(o[r].handleMessage(this,s,e))return}a.Logger.default.error("CrossWindowController message could not be handled",this,s,e)}}else a.Logger.default.error("CrossWindowController null message bridge")}else a.Logger.default.error("CrossWindowController received invalid message",e)},e.prototype.validateCrossWindowMessage=function(e){return null!=e.messageId&&null!=e.messageId&&e.messageId.length>0&&null!=e.action&&null!=e.action&&e.action.length>0},e.prototype.callResponseCallback=function(e){var s=this.responseCallbacks[e.messageId];return!!s&&s(e)},e}();s.CrossWindowControllerImpl=v},321:(e,s)=>{s.__esModule=!0,function(e){e.RegisterWindow="RegisterWindow",e.PostReceiverMessage="PostReceiverMessage",e.PostNativeMessage="PostNativeMessage",e.IsNativeReadyRequest="IsNativeReadyRequest",e.IsNativeReadyResponse="IsNativeReadyResponse",e.IsSdkWebViewRequest="IsSdkWebViewRequest",e.IsSdkWebViewResponse="IsSdkWebViewResponse"}(s.CrossWindowMessageAction||(s.CrossWindowMessageAction={}))},95:(e,s)=>{s.__esModule=!0,function(e){e.Root="Root",e.Frame="Frame"}(s.CrossWindowMode||(s.CrossWindowMode={}))},294:(e,s)=>{s.__esModule=!0;var r=function(e){this.isNativeReady=e};s.IsNativeReadyResponseData=r},281:(e,s)=>{s.__esModule=!0;var r=function(e){this.isSdkWebView=e};s.IsSdkWebViewResponseData=r},207:(e,s,r)=>{s.__esModule=!0;var o=r(321),t=r(95),a=r(938),n=r(995),i=r(281),d=function(){function e(){}return e.prototype.handleMessage=function(e,s,r){try{if(r.action===o.CrossWindowMessageAction.IsSdkWebViewRequest){if(e.mode===t.CrossWindowMode.Root){var d=new i.IsSdkWebViewResponseData(s.nativeController.isSdkWebView(s)),l=new a.CrossWindowMessageImpl(o.CrossWindowMessageAction.IsSdkWebViewResponse,d,r.messageId);e.postMessage(l),n.Logger.default.debug("Processed IsSdkWebViewRequest",r,l)}else n.Logger.default.warn("Frame Message Bridge received invalid message",r);return!0}if(r.action===o.CrossWindowMessageAction.IsSdkWebViewResponse){if(e.mode===t.CrossWindowMode.Frame){d=r.data;s.nativeController.setIsSdkWebView(d.isSdkWebView),n.Logger.default.debug("Processed IsSdkWebViewResponse",r,d)}else n.Logger.default.warn("Root Message Bridge received invalid message",r);return!0}}catch(o){n.Logger.default.error("IsSdkWebViewMessageDelegate handle message failed",e,s,r,o)}return!1},e}();s.IsSdkWebViewMessageDelegate=d},448:(e,s,r)=>{s.__esModule=!0;var o=r(321),t=r(995),a=r(95),n=function(){function e(){}return e.prototype.handleMessage=function(e,s,r){try{if(r.action===o.CrossWindowMessageAction.PostNativeMessage){if(e.mode===a.CrossWindowMode.Root){var n=r.data;return s.messageController.postEventMessageToNative(s,n),t.Logger.default.debug("Relayed Native Message"),!0}return t.Logger.default.warn("Frame Message Bridge received invalid message",r),!0}}catch(o){t.Logger.default.error("NativeMessageDelegate handle message failed",e,s,r,o)}return!1},e}();s.NativeMessageDelegate=n},820:(e,s,r)=>{s.__esModule=!0;var o=r(321),t=r(95),a=r(294),n=r(995),i=r(938),d=function(){function e(){}return e.prototype.handleMessage=function(e,s,r){try{if(r.action===o.CrossWindowMessageAction.IsNativeReadyRequest){if(e.mode===t.CrossWindowMode.Root){var d=new a.IsNativeReadyResponseData(s.nativeReady),l=new i.CrossWindowMessageImpl(o.CrossWindowMessageAction.IsNativeReadyResponse,d,r.messageId);e.postMessage(l),n.Logger.default.debug("Processed IsNativeReadyRequest",r,l)}else n.Logger.default.warn("Frame Message Bridge received invalid message",r);return!0}if(r.action===o.CrossWindowMessageAction.IsNativeReadyResponse){if(e.mode===t.CrossWindowMode.Frame){var g=r.data;g.isNativeReady&&s.setNativeReady(),n.Logger.default.debug("Processed IsNativeReadyResponseData",r,g,this)}else n.Logger.default.warn("Root Message Bridge received invalid message",r);return!0}}catch(o){n.Logger.default.error("NativeReadyMessageDelegate handle message failed",e,s,r,o)}return!1},e}();s.NativeReadyMessageDelegate=d},870:(e,s,r)=>{s.__esModule=!0;var o=r(321),t=r(995),a=r(95),n=function(){function e(){}return e.prototype.handleMessage=function(e,s,r){try{if(r.action===o.CrossWindowMessageAction.PostReceiverMessage){if(e.mode===a.CrossWindowMode.Frame){var n=r.data;try{s.postMessage(n,!0)}catch(e){t.Logger.default.error("Relayed Receiver Message failed to post message via bridge",r,s)}t.Logger.default.debug("Relayed Receiver Message to Message Bridge",r,s)}else t.Logger.default.warn("Root Message Bridge received invalid message",r);return!0}}catch(o){t.Logger.default.error("ReceiverMessageDelegate handle message failed",e,s,r,o)}return!1},e}();s.ReceiverMessageDelegate=n},24:(e,s,r)=>{s.__esModule=!0;var o=r(95),t=r(321),a=r(995),n=function(){function e(){}return e.prototype.handleMessage=function(e,s,r){try{if(r.action===t.CrossWindowMessageAction.RegisterWindow){if(e.mode===o.CrossWindowMode.Root){var n=r.sourceWindowId;e.windows.push(n),a.Logger.default.debug("CrossWindow registered",n)}else a.Logger.default.warn("Frame Message Bridge received invalid message",r);return!0}}catch(e){a.Logger.default.error("CrossWindow failed to register",r)}return!1},e}();s.RegisterWindowMessageDelegate=n},938:(e,s,r)=>{s.__esModule=!0;var o=r(532),t=r(933),a=function(){function e(e,s,r,a,n){void 0===r&&(r=t.Utils.createUUIDv4()),void 0===a&&(a=window.origin),void 0===n&&(n=o.CrossWindowControllerImpl.getWindowId()),this.messageId=r,this.sourceWindowId=n,this.sourceOrigin=a,this.action=e,this.data=s}return e.prototype.encode=function(){return JSON.stringify(this)},e.decode=function(e){return JSON.parse(e)},e}();s.CrossWindowMessageImpl=a},539:(e,s,r)=>{s.__esModule=!0;var o=r(995),t=function(){function e(){}return e.postMessageToNestedWindows=function(s,r){try{for(var t=r.frames,a=0;a<t.length;a++){var n=t[a];e.postMessageToWindow(s,n);try{this.postMessageToNestedWindows(s,n)}catch(e){o.Logger.default.error("CrossWindowMessage post failed to deep nested window")}}}catch(e){o.Logger.default.error("CrossWindowMessage post failed to nested window")}},e.postMessageToWindow=function(e,s){try{o.Logger.default.debug("CrossWindowMessage Will Send",e,window.__KlarnaNativeHook);s.postMessage(e,"*"),o.Logger.default.debug("CrossWindowMessage Sent",e,window.__KlarnaNativeHook,"*")}catch(s){o.Logger.default.error("CrossWindowMessage Failed to Send",s,e,window.__KlarnaNativeHook)}},e}();s.CrossWindowUtils=t},179:(e,s,r)=>{s.__esModule=!0;var o=r(791),t=r(593),a=r(621),n=r(749),i=r(779),d=r(218),l=r(777),g=r(299),u=r(321),c=r(95),p=r(938),v=r(548),f=function(){function e(){this.nativeMessageSender=new o.NativeMessageSender,this.componentMessageSender=new t.ComponentMessageSender,this.messageProcessors=[new a.HandshakeResponseActionMessageProcessor,new n.StringifiedProductOptionsMessageProcessor,new i.SetExperimentsFormatMessageProcessor,new d.PaymentsWrapperExtractBase64MessageProcessor,new l.SessionDataBase64MessageProcessor,new g.FullscreenShowCanScrollMessageProcessor,new v.HandshakeCacheMessageProcessor]}return e.prototype.postMessage=function(e,s,r){r&&e.crossWindowController.mode===c.CrossWindowMode.Root&&e.crossWindowController.postMessage(new p.CrossWindowMessageImpl(u.CrossWindowMessageAction.PostReceiverMessage,s)),this.messageProcessors.forEach((function(o,t){o.processMessage(e,s,r)})),this.componentMessageSender.sendMessage(e,s),r||this.nativeMessageSender.sendMessage(e,s)},e.prototype.postEventMessageToNative=function(e,s){this.nativeMessageSender.postEventMessageToNative(e,s)},e}();s.MessageControllerImpl=f},299:(e,s,r)=>{s.__esModule=!0;var o=r(933),t=function(){function e(){}return e.getHandshakeResponseParams=function(e,s,r){return r?o.Utils.getHandshakeResponseParams(e,s.receiver):o.Utils.getHandshakeResponseParams(e,s.sender)},e.prototype.processMessage=function(s,r,o){var t;"fullscreenShow"===r.action&&("android"===(null===(t=e.getHandshakeResponseParams(s,r,o))||void 0===t?void 0:t.osName)&&(r.params.canScroll="true"))},e}();s.FullscreenShowCanScrollMessageProcessor=t},548:(e,s,r)=>{s.__esModule=!0;var o=r(995),t=r(327),a=function(){function e(){}return e.prototype.processMessage=function(e,s,r){if(s.action===t.ClientMessageActions.handshakeResponse)try{e.handshakeResponseParamsMap[s.receiver]=s.params,o.Logger.default.debug("Cached handshake",s.receiver,s.params)}catch(e){var a="Error caching handshake response params: ";try{a+=JSON.stringify(e)}catch(e){}finally{o.Logger.default.error("cache-handshakeResponseParams",{msg:a})}}},e}();s.HandshakeCacheMessageProcessor=a},621:(e,s)=>{s.__esModule=!0;var r=function(){function e(){}return e.prototype.processMessage=function(e,s,r){"handhakeResponse"===s.action&&(s.action="handshakeResponse")},e}();s.HandshakeResponseActionMessageProcessor=r},218:(e,s,r)=>{s.__esModule=!0;var o=r(995),t=function(){function e(){}return e.prototype.processMessage=function(e,s,r){"handshake"===s.action&&"KlarnaPaymentsWrapper"===s.sender&&window.__WrapperMessageController&&window.__WrapperMessageController._extractBase64&&(window.__WrapperMessageController._extractBase64=function(e,s,r){if(null==e.params[r]||"null"===e.params[r])return null;try{var t=e.params[r],a=atob(t);return JSON.parse(a)}catch(e){o.Logger.default.error("extract-b64",{msg:"Error extracting b64 with custom atob() "+JSON.stringify(e)})}})},e}();s.PaymentsWrapperExtractBase64MessageProcessor=t},777:(e,s,r)=>{s.__esModule=!0;var o=r(79),t=r(995),a=function(){function e(){}return e.prototype.processMessage=function(e,s,r){if("actionToComponent"===s.action)try{if("undefined"!==s.params.sessionData&&null!=s.params.sessionData)if("null"===s.params.sessionData)delete s.params.sessionData;else{var a=s.params.sessionData;s.params.sessionData=o.KlarnaUtf8Base64Prefix+a.replace(/\n/g,"").replace(/-/g,"+").replace(/_/g,"/")}}catch(e){t.Logger.default.error("re-format-session-data",{msg:"Error reformatting session data: "+JSON.stringify(e)})}},e}();s.SessionDataBase64MessageProcessor=a},779:(e,s,r)=>{s.__esModule=!0;var o=r(995),t=function(){function e(){}return e.prototype.processMessage=function(e,s,r){if("setExperiments"===s.action){try{if(void 0!==s.params.experiments&&"undefined"!==s.params.experiments&&null!=s.params.experiments){var t=s.params.experiments;o.Logger.default.debug("rewrite-experiments-info",{msg:"Experiments JSON received: "+t}),"string"!=typeof t&&(s.params.experiments=JSON.stringify(t))}}catch(e){o.Logger.default.error("rewrite-experiments",{msg:"Error stringifying experiments parameter sent from KP: "+JSON.stringify(e)})}try{if(void 0!==s.params.experiments&&"undefined"!==s.params.experiments&&null!=s.params.experiments){var a=s.params.experiments;if("string"==typeof a){var n=JSON.parse(a),i=[];for(var d in n){var l=n[d];null!=l.variate&&void 0!==l.variate||(l.variate=""),i.push(l)}s.params.experiments=JSON.stringify(i)}}}catch(e){o.Logger.default.error("rewrite-experiments-variates",{msg:"Error adding missing variate parameter in experiments sent from KP: "+JSON.stringify(e)})}}},e}();s.SetExperimentsFormatMessageProcessor=t},749:(e,s,r)=>{s.__esModule=!0;var o=r(714),t=r(995),a=function(){function e(){}return e.prototype.processMessage=function(e,s,r){if("handshakeResponse"===s.action)try{for(var a=s.params.osName,n=s.params.nativeVersion,i=0,d=o.StringifiedKlarnaInitDataSdks;i<d.length;i++){var l=d[i];if(a===l.osName&&n===l.nativeVersion){var g=s.params.productOptions;if(void 0!==g&&"undefined"!==g&&null!=g){var u=JSON.parse(g);if(null!=u&&null!=u.klarnaInitData)try{var c=JSON.parse(u.klarnaInitData);u.klarnaInitData=c,s.params.productOptions=JSON.stringify(u)}catch(e){var p="Error parsing klarnaInitData parameter inside productOptions: ";try{p+=JSON.stringify(e)}catch(e){}finally{t.Logger.default.error("rewrite-productOptions",{msg:p})}}}}}}catch(e){p="Error parsing productOptions parameter: ";try{p+=JSON.stringify(e)}catch(e){}finally{t.Logger.default.error("rewrite-productOptions",{msg:p})}}},e}();s.StringifiedProductOptionsMessageProcessor=a},593:(e,s,r)=>{s.__esModule=!0;var o=r(995),t=r(959),a=r(327),n=r(933),i=function(){function e(){}return e.isKlarnaPaymentsReady=function(e){var s=n.Utils.getHandshakeResponseParams(e,t.KlarnaProductNames.KlarnaPayments);return null!=s&&null!=s},e.queueMessageIfNeeded=function(s,r){return"Native"===r.sender&&r.receiver===t.KlarnaProductNames.KlarnaPaymentsWrapper&&r.action!==a.ClientMessageActions.handshakeResponse&&!e.isKlarnaPaymentsReady(s)&&(s.queuedKlarnaPaymentsMessages.push(r),o.Logger.default.info("Message Queued",r),!0)},e.prototype.releaseQueuedMessagesIfReady=function(s,r){if("Native"===r.sender&&r.receiver===t.KlarnaProductNames.KlarnaPayments&&r.action===a.ClientMessageActions.handshakeResponse&&e.isKlarnaPaymentsReady(s)&&s.queuedKlarnaPaymentsMessages.length>0){o.Logger.default.debug("KlarnaPayments received handshake response, de-queuing messages.");for(var n=0,i=s.queuedKlarnaPaymentsMessages;n<i.length;n++){var d=i[n];this.sendMessage(s,d),o.Logger.default.info("Message De-queued",d)}return s.queuedKlarnaPaymentsMessages=[],!0}return!1},e.prototype.sendMessage=function(s,r){if(!e.queueMessageIfNeeded(s,r)){for(var t=0,a=s.receivers;t<a.length;t++){var n=a[t];n.name!==r.receiver&&"*"!==r.receiver||(n.callback(r),o.Logger.default.info("Receiver Notified for Message",r,n))}this.releaseQueuedMessagesIfReady(s,r)}},e}();s.ComponentMessageSender=i},791:(e,s,r)=>{s.__esModule=!0;var o=r(149),t=r(442),a=r(356),n=r(933),i=r(618),d=r(95),l=r(321),g=r(938),u=r(995),c=function(){function e(){this.delayedMessages=[],this.sendDelayedMessagesWithInterval()}return e.createBridgeMessage=function(e){return new t.BridgeMessageImpl(a.BridgeMessageAction.MessagePosted,null,e,null)},e.shouldDelayMessage=function(e,s){if(-1!==o.ClientFullscreenActions.indexOf(s.action)){var r=n.Utils.getHandshakeResponseParams(e,s.sender);if(r)for(var t=r.osName,a=r.merchantAppName,d=0,l=i.DelayedFullscreenMerchants;d<l.length;d++){var g=l[d];if(t===g.osName&&a===g.merchantAppName)return!0}}return!1},e.prototype.sendMessage=function(s,r){s.nativeReady?e.shouldDelayMessage(s,r)?this.delayedMessages.push(new p(s,r)):this.postEventMessageToNative(s,e.createBridgeMessage(r)):s.queuedMessages.push(r)},e.prototype.postEventMessageToNative=function(e,s){if(e.crossWindowController.mode===d.CrossWindowMode.Frame)e.crossWindowController.postMessage(new g.CrossWindowMessageImpl(l.CrossWindowMessageAction.PostNativeMessage,s));else{var r=e.nativeController.getNativeMessageHandler();null!=r&&(r.postMessage(JSON.stringify(s)),u.Logger.default.info("Native Notified for Message",s,r))}},e.prototype.sendDelayedMessagesWithInterval=function(){var s=this;window.setInterval((function(){var r=s.delayedMessages.shift();null!=r&&null!=r.message&&s.postEventMessageToNative(r.messageBridge,e.createBridgeMessage(r.message))}),200)},e}();s.NativeMessageSender=c;var p=function(e,s){this.messageBridge=e,this.message=s}},140:(e,s,r)=>{s.__esModule=!0;var o=r(442),t=r(356),a=r(95),n=r(294),i=r(321),d=r(938),l=r(281),g=function(){function e(){this._isSdkWebView=!1}return e.prototype.isNativeReady=function(e){return e.nativeReady},e.prototype.isNativeReadyAsync=function(e){return e.crossWindowController.mode===a.CrossWindowMode.Root?new Promise((function(s){return s(e.isNativeReady())})):new Promise((function(s,r){var o=window.setTimeout((function(){r("CrossWindowMessage Response Timeout")}),3e3),t=new d.CrossWindowMessageImpl(i.CrossWindowMessageAction.IsNativeReadyRequest,null);e.crossWindowController.postMessage(t,(function(e){if(e.action===i.CrossWindowMessageAction.IsNativeReadyResponse){var r=e.data;window.clearTimeout(o),s(r.isNativeReady)}return!1}))}))},e.prototype.isSdkWebView=function(e){var s=null!=this.getNativeMessageHandler();if(s!=this._isSdkWebView)if(e.crossWindowController.mode===a.CrossWindowMode.Root){var r=new l.IsSdkWebViewResponseData(s),o=new d.CrossWindowMessageImpl(i.CrossWindowMessageAction.IsSdkWebViewResponse,r);e.crossWindowController.postMessage(o),this._isSdkWebView=s}else s&&(this._isSdkWebView=s);return this._isSdkWebView},e.prototype.isSdkWebViewAsync=function(e){var s=this;return e.crossWindowController.mode===a.CrossWindowMode.Root?new Promise((function(r){return r(s.isSdkWebView(e))})):new Promise((function(r,o){var t=window.setTimeout((function(){o("CrossWindowMessage Response Timeout")}),3e3),a=new d.CrossWindowMessageImpl(i.CrossWindowMessageAction.IsSdkWebViewRequest,null);e.crossWindowController.postMessage(a,(function(e){if(e.action===i.CrossWindowMessageAction.IsSdkWebViewResponse){var o=e.data;s._isSdkWebView=o.isSdkWebView,window.clearTimeout(t),r(o.isSdkWebView)}return!1}))}))},e.prototype.setNativeReady=function(e){if(e.nativeReady)e.messageController.postEventMessageToNative(e,new o.BridgeMessageImpl(t.BridgeMessageAction.MessageBridgeAlreadyRunning,null,null,null)),e.notifyEvent({name:"NativeHookAlreadyReady",payload:{receivers:e.receivers.toString(),queuedMessages:e.queuedMessages.toString()}});else{e.nativeReady=!0,e.messageController.postEventMessageToNative(e,new o.BridgeMessageImpl(t.BridgeMessageAction.MessageBridgeWillStart,null,null,null));for(var s=0,r=e.receivers.filter((function(e){return!e.registeredNatively}));s<r.length;s++){var l=r[s];e.messageController.postEventMessageToNative(e,new o.BridgeMessageImpl(t.BridgeMessageAction.ReceiverAdded,l.name,null,null)),l.registeredNatively=!0}for(var g=0,u=e.queuedMessages;g<u.length;g++){var c=u[g];e.messageController.postEventMessageToNative(e,new o.BridgeMessageImpl(t.BridgeMessageAction.MessagePosted,null,c,null))}if(e.queuedMessages=[],e.crossWindowController.mode===a.CrossWindowMode.Root){var p=new n.IsNativeReadyResponseData(e.nativeReady);c=new d.CrossWindowMessageImpl(i.CrossWindowMessageAction.IsNativeReadyResponse,p);e.crossWindowController.postMessage(c)}e.notifyEvent({name:"NativeHookReady",payload:{receivers:e.receivers.toString(),queuedMessages:e.queuedMessages.toString()}})}},e.prototype.setIsSdkWebView=function(e){this._isSdkWebView=e},e.prototype.getNativeMessageHandler=function(){return e.getNativeMessageHandler()},e.getNativeMessageHandler=function(){var e;return window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.KlarnaNativeHookMessageHandler?e=window.webkit.messageHandlers.KlarnaNativeHookMessageHandler:window.KlarnaNativeHookMessageHandler&&(e=window.KlarnaNativeHookMessageHandler),e},e}();s.NativeControllerImpl=g},571:(e,s,r)=>{s.__esModule=!0;var o=r(242),t=r(442),a=r(356),n=function(){function e(){}return e.prototype.addReceiver=function(e,s,r){var n=new o.MessageReceiverImpl(s,r);e.nativeReady&&(e.messageController.postEventMessageToNative(e,new t.BridgeMessageImpl(a.BridgeMessageAction.ReceiverAdded,n.name,null,null)),n.registeredNatively=!0),e.receivers.push(n)},e.prototype.removeReceiver=function(e,s,r){e.receivers=e.receivers.filter((function(e){return e.name!==s&&e.callback!==r})),e.nativeReady&&e.messageController.postEventMessageToNative(e,new t.BridgeMessageImpl(a.BridgeMessageAction.ReceiverRemoved,s,null,null))},e}();s.ReceiverControllerImpl=n},995:(e,s)=>{var r;s.__esModule=!0,function(e){e[e.Debug=0]="Debug",e[e.Info=1]="Info",e[e.Warn=2]="Warn",e[e.Error=3]="Error",e[e.None=4]="None"}(r=s.LogLevel||(s.LogLevel={}));var o=function(){function e(){this.level=r.None,this.delegate=null}return e.prototype.debug=function(){for(var e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];try{this.level===r.Debug&&(null!=this.delegate&&this.delegate.logDebug(this._stringifyParams(e)),console.log.apply(console,e))}catch(e){}},e.prototype.info=function(){for(var e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];try{this.level<=r.Info&&(null!=this.delegate&&this.delegate.logDebug(this._stringifyParams(e)),console.info.apply(console,e))}catch(e){}},e.prototype.warn=function(){for(var e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];try{this.level<=r.Warn&&(null!=this.delegate&&this.delegate.logDebug(this._stringifyParams(e)),console.warn.apply(console,e))}catch(e){}},e.prototype.error=function(){for(var e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];try{this.level<=r.Error&&(null!=this.delegate&&this.delegate.logError(this._stringifyParams(e)),console.error.apply(console,e))}catch(e){}},e.prototype._stringifyParams=function(e){try{return JSON.stringify(e,null,2)}catch(e){return"Couldn't stringify logging params."}},e.default=new e,e}();s.Logger=o},933:(e,s,r)=>{s.__esModule=!0;var o=r(995),t=function(){function e(){}return e.getHandshakeResponseParams=function(e,s){return e.handshakeResponseParamsMap[s]},e.compareVersion=function(e,s){for(var r=e.split("-")[0].replace("v","").split(".").map((function(e){var s=parseInt(e,10);return isNaN(s)?0:s}));r.length<3;)r.push(0);for(var o=s.split("-")[0].replace("v","").split(".").map((function(e){var s=parseInt(e,10);return isNaN(s)?0:s}));o.length<3;)o.push(0);return r[0]>o[0]?1:r[0]<o[0]?-1:r[1]>o[1]?1:r[1]<o[1]?-1:r[2]>o[2]?1:r[2]<o[2]?-1:0},e.createUUIDv4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var s=16*Math.random()|0;return("x"==e?s:3&s|8).toString(16)}))},e.replaceBridge=function(e,s){o.Logger.default.info("Replacing old bridge",e);var r=e.receivers,t=e.queuedMessages,a=e.eventListeners,n=e.handshakeResponseParamsMap,i=e.queuedKlarnaPaymentsMessages;if(s.notifyEvent({name:"WillReplaceNativeHook",payload:{oldMessageBridgeVersion:e.version,newMessageBridgeVersion:s.version,receivers:r.toString(),queuedMessages:t.toString(),nativeReady:e.nativeReady.toString()}}),window.__KlarnaNativeHook=s,s.notifyEvent({name:"ReplacedNativeHook",payload:{oldMessageBridgeVersion:e.version,newMessageBridgeVersion:s.version}}),e.destroy&&e.destroy(),null!=a&&a.forEach((function(e){return s.addEventListener(e)})),null!=n)if(n.forEach)n.forEach((function(e,r){s.handshakeResponseParamsMap[r]=e}));else for(var d in n)s.handshakeResponseParamsMap[d]=n[d];t.forEach((function(e){return s.queuedMessages.push(e)})),r.forEach((function(e){return s.addReceiver(e.name,e.callback)})),void 0!==i&&i.forEach((function(e){return s.queuedKlarnaPaymentsMessages.push(e)})),e.nativeReady&&s.setNativeReady(),o.Logger.default.info("Replaced old bridge",s)},e}();s.Utils=t},356:(e,s)=>{s.__esModule=!0,function(e){e.ReceiverAdded="ReceiverAdded",e.ReceiverRemoved="ReceiverRemoved",e.MessagePosted="MessagePosted",e.EndpointsReported="EndpointsReported",e.MessageBridgeWillStart="MessageBridgeWillStart",e.MessageBridgeAlreadyRunning="MessageBridgeAlreadyRunning"}(s.BridgeMessageAction||(s.BridgeMessageAction={}))},149:(e,s,r)=>{s.__esModule=!0;var o=r(327);s.ClientFullscreenActions=[o.ClientMessageActions.fullscreenReplaceWebView,o.ClientMessageActions.fullscreenMoveWebView,o.ClientMessageActions.fullscreenReplaceOverlay,o.ClientMessageActions.fullscreenRestoreWebView]},327:(e,s)=>{s.__esModule=!0,function(e){e.fullscreenReplaceWebView="fullscreenReplaceWebView",e.fullscreenMoveWebView="fullscreenMoveWebView",e.fullscreenReplaceOverlay="fullscreenReplaceOverlay",e.fullscreenRestoreWebView="fullscreenRestoreWebView",e.handshakeResponse="handshakeResponse",e.actionToComponent="actionToComponent"}(s.ClientMessageActions||(s.ClientMessageActions={}))},618:(e,s)=>{s.__esModule=!0,s.DelayedFullscreenMerchants=[{merchantAppName:"boohooMAN",osName:"iOS"},{merchantAppName:"Nasty Gal",osName:"iOS"},{merchantAppName:"MISSPAP",osName:"iOS"},{merchantAppName:"boohoo",osName:"iOS"},{merchantAppName:"PLT UAT",osName:"iOS"}]},74:(e,s)=>{s.__esModule=!0,s.Endpoints={Analytics:{Staging:"evt-eu.staging.eu1.yaco.klarna.net",Production:"not-reallly-evt.klarna.com"},DeviceData:{Staging:"devicedata-staging.klarna",Production:"devicedata-production.klarna"}}},959:(e,s)=>{s.__esModule=!0,function(e){e.KlarnaPayments="KlarnaPayments",e.KlarnaPaymentsWrapper="KlarnaPaymentsWrapper"}(s.KlarnaProductNames||(s.KlarnaProductNames={}))},79:(e,s)=>{s.__esModule=!0,s.KlarnaUtf8Base64Prefix="klarna-base-64-utf8::",s.MessageBridgeVersion="v1.3.1-629b42de9dd"},714:(e,s)=>{s.__esModule=!0,s.StringifiedKlarnaInitDataSdks=[{osName:"iOS",nativeVersion:"2.0.26"},{osName:"iOS",nativeVersion:"2.0.27"},{osName:"iOS",nativeVersion:"2.0.28"},{osName:"android",nativeVersion:"2.0.26"},{osName:"android",nativeVersion:"2.0.27"},{osName:"android",nativeVersion:"2.0.28"},{osName:"android",nativeVersion:"2.0.29"}]},26:(e,s)=>{s.__esModule=!0;var r=function(e,s,r){this.bridgeVersion=e,this.endpoints={analytics:s,deviceInfo:r}};s.BridgeDataImpl=r},442:(e,s)=>{s.__esModule=!0;var r=function(e,s,r,o){this.action=e,this.receiverName=s,this.message=r,this.bridgeData=o};s.BridgeMessageImpl=r},857:(e,s)=>{s.__esModule=!0;var r=function(e,s){this.staging=e,this.production=s};s.EndpointDataImpl=r},242:(e,s,r)=>{s.__esModule=!0;var o=r(933),t=function(e,s){this.registeredNatively=!1,this.id=o.Utils.createUUIDv4(),this.name=e,this.callback=s};s.MessageReceiverImpl=t}},s={};function r(o){var t=s[o];if(void 0!==t)return t.exports;var a=s[o]={exports:{}};return e[o](a,a.exports,r),a.exports}var o={};(()=>{o.__esModule=!0;var e=r(935),s=r(933),t=r(79);!function(){try{null==window.__KlarnaNativeHook?window.__KlarnaNativeHook=new e.MessageBridgeImpl:1===s.Utils.compareVersion(t.MessageBridgeVersion,window.__KlarnaNativeHook.version)&&s.Utils.replaceBridge(window.__KlarnaNativeHook,new e.MessageBridgeImpl)}catch(e){console.error("__KlarnaNativeHook MessageBridge initialization failed.",e)}}()})();for(var t in o)this[t]=o[t];o.__esModule&&Object.defineProperty(this,"__esModule",{value:!0})})();